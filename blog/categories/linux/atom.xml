<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux | Hao Ruan's 部落格]]></title>
  <link href="http:///blog/categories/linux/atom.xml" rel="self"/>
  <link href="http:///"/>
  <updated>2017-07-30T22:41:47+08:00</updated>
  <id>http:///</id>
  <author>
    <name><![CDATA[Hao Ruan]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Tcpip]]></title>
    <link href="http:///blog/2016/12/19/tcpip/"/>
    <updated>2016-12-19T16:38:32+08:00</updated>
    <id>http:///blog/2016/12/19/tcpip</id>
    <content type="html"><![CDATA[<h3 id="tcp--ip-">TCP / IP 报文格式</h3>

<p>```
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Version|  IHL  |Type of Service|          Total Length         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Identification        |Flags|      Fragment Offset    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Time to Live |    Protocol   |         Header Checksum       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Source Address                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Destination Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Options                    |    Padding    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</p>

<p>```</p>

<p>```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |          Source Port          |       Destination Port        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                        Sequence Number                        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Acknowledgment Number                      |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |  Data |       |C|E|U|A|P|R|S|F|                               |
 | Offset|  Res. |W|C|R|C|S|S|Y|I|            Window             |
 |       |       |R|E|G|K|H|T|N|N|                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |           Checksum            |         Urgent Pointer        |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                    Options                    |    Padding    |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                             data                              |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</p>

<p>```</p>

<h3 id="tcp-">TCP 状态机</h3>

<p><img src="/images/examples/tcp_state_machine.jpg"></p>

<p><img src="/images/examples/tcp_state_machine2.png"></p>

<p><img src="/images/examples/tcp_state_machine3.jpg"></p>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Top]]></title>
    <link href="http:///blog/2016/11/30/top/"/>
    <updated>2016-11-30T13:41:06+08:00</updated>
    <id>http:///blog/2016/11/30/top</id>
    <content type="html"><![CDATA[<p><img src="/images/examples/top.png"></p>

<h3 id="section">性能指标</h3>

<ul>
  <li>us: 如果大于 50%，说明用户进程消耗的cpu时间多，需要考虑优化用户的程序</li>
  <li>us+sy: 大于 80% 说明可能存在 CPU 不足</li>
  <li>wa: 显示了 IO 等待所占用的 CPU 时间百分比。如果 wa 超过 30%，说明 IO 等待严重，可能是磁盘大量随机访问造成的，也可能磁盘或者磁盘访问控制器的带宽瓶颈造成的(主要是块操作)</li>
  <li>st(steal): 在如 Xen 等虚拟环境下 CPU 运行虚拟机时间的百分比。太高表示可能需要停止一些虚拟机</li>
</ul>

<h3 id="section-1">内存数量说明</h3>

<p>第四行中使用中的内存（used）指的是当前系统內核控制的内存数量，空闲内存（free）是内核尚未纳入其管控范围的數量。</p>

<p>纳入内核管理的内存不见得都在使用中，还包括可以被重复利用的内存，内核并不把这些可被重新使用的内存交换到 free 中去，因此在 linux 上 free 内存会越来越少，无需担心。</p>

<p>如果第五行 swap used 数值不为零且不断变化，说明内核不断进行内存 swap 操作，这是真正内存告急的征兆。</p>

<h3 id="buffers--cached">buffers &amp; cached</h3>

<p>buffers 和 cached 是内核管理的可用内存。从应用程序角度来看，buffers/cached 是等于可用的。</p>

<p>当应用程序需在用到内存的时候，buffers/cached 可以很快得被回收。</p>

<p>buffers/cached 可以用来提高文件读写性能，buffers 给块设备做缓冲区，cached 给文件做缓冲区。</p>

<h3 id="section-2">内存计算</h3>

<p>可用内存：free + ( buffers + cached )</p>

<p>已用内存：used - ( buffers + cached )</p>

<h3 id="shr">SHR</h3>

<p>SHR 是指加载外部动态库 (.so) 或者以共享内存方式进行进程间通信时所使用的共享内存区域。</p>

<p>这部分物理内存空间其实是被多个进程所共享的，所以称为共享内存。某个进程占用的内存除了和别的进程共享的内存之外就是自己的独占内存了。所以要计算进程独占内存的大小只要用 RES 的值减去 SHR 值即可。</p>

<h3 id="section-3">实用技巧</h3>

<ul>
  <li>P: CPU 排序</li>
  <li>M: 内存排序</li>
  <li>1: 显示 SMP 负载情况</li>
  <li>H: 显示线程信息</li>
  <li>z: 高亮模式</li>
  <li>c: 显示完整命令名</li>
  <li>k: kill 指定进程</li>
  <li>x: 指定排序栏高亮</li>
  <li>&lt; 和 &gt;: 指定排序栏</li>
  <li>top -p <pid>: 显示指定进程</pid></li>
  <li>top -bn 1: 显示一屏信息，用于脚本</li>
  <li>top -M 使用 megabytes 为单位</li>
  <li>top -H -p <pid>: 监控指定进程和进行内线程信息</pid></li>
</ul>

<h3 id="refs">Refs</h3>

<p><a href="http://www.cnblogs.com/bravery/archive/2012/06/27/2560611.html">观察进程的内存占用情况</a></p>
]]></content>
  </entry>
  
</feed>
