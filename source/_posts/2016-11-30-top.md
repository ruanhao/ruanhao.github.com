---
layout: post
title: "top"
date: 2016-11-30 13:41:06 +0800
comments: true
categories: cli linux
---

{% img /images/examples/top.png %}

### 性能指标

* us: 如果大于 50%，说明用户进程消耗的cpu时间多，需要考虑优化用户的程序
* us+sy: 大于 80% 说明可能存在 CPU 不足
* wa: 显示了 IO 等待所占用的 CPU 时间百分比。如果 wa 超过 30%，说明 IO 等待严重，可能是磁盘大量随机访问造成的，也可能磁盘或者磁盘访问控制器的带宽瓶颈造成的(主要是块操作)
* st(steal): 在如 Xen 等虚拟环境下 CPU 运行虚拟机时间的百分比。太高表示可能需要停止一些虚拟机

### 内存数量说明

第四行中使用中的内存（used）指的是当前系统內核控制的内存数量，空闲内存（free）是内核尚未纳入其管控范围的數量。

纳入内核管理的内存不见得都在使用中，还包括可以被重复利用的内存，内核并不把这些可被重新使用的内存交换到 free 中去，因此在 linux 上 free 内存会越来越少，无需担心。

如果第五行 swap used 数值不为零且不断变化，说明内核不断进行内存 swap 操作，这是真正内存告急的征兆。

### buffers & cached

buffers 和 cached 是内核管理的可用内存。从应用程序角度来看，buffers/cached 是等于可用的。

当应用程序需在用到内存的时候，buffers/cached 可以很快得被回收。

buffers/cached 可以用来提高文件读写性能，buffers 给块设备做缓冲区，cached 给文件做缓冲区。

### 内存计算

可用内存：free + ( buffers + cached )

已用内存：used - ( buffers + cached )

### 实用技巧

* P: CPU 排序
* M: 内存排序
* 1: 显示 SMP 负载情况
* H: 显示线程信息
* z: 高亮模式
* c: 显示完整命令名
* k: kill 指定进程
* x: 指定排序栏高亮
* < 和 >: 指定排序栏
* top -p <pid>: 显示指定进程
* top -bn 1: 显示一屏信息，用于脚本
* top -M 使用 megabytes 为单位
* top -H -p <pid>: 监控指定进程和进行内线程信息


