---
layout: post
title: "ssh"
date: 2016-09-14 14:35:45 +0800
comments: true
categories: cli
---

## Remote Forward

`ssh -N -f -R <remote-port>:<dest-host>:<dest-host-port> user@remote-host`


{% img /images/examples/ssh.png %}

\<remote-port\> 监听在 localhost 上，如需要被外部访问，可以在 remote-host 上再添加一个端口转发:

`socat TCP4-LISTEN:8888,reuseaddr,fork TCP4:127.0.0.1:<remote-port> &`

这样外部可以通过 \<remote-host\>:8888 访问 \<dest-host\>:\<dest-host-port\>

[Ref1](http://www.ruanyifeng.com/blog/2011/12/ssh_port_forwarding.html)

[Ref2](http://www.liugj.com/2013/04/SSH-port-forwarding/)

## Misc

* 在远程机器上运行一段脚本（不必把脚本拷贝到远程机器上)

`ssh user@server bash < /path/to/local/script.sh`

* 比较一个远程文件个一个本地文件

`ssh user@host cat /path/to/remotefile | diff /path/to/localfile -`

* cat 文件

`ssh user@host 'mkdir -p .ssh && cat >> .ssh/authorized_keys' < ~/.ssh/id_rsa.pub `


